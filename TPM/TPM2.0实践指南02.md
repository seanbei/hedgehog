# 第二章 基本的安全概念
本章主要讲安全概念的概况及其在 `TPM` 中的应用。这些概念中有一些潜在的数学方法，对你来说并不用掌握，所以这里不会提到它们。相反，本章主要讨论各种加密算法的表象，帮助你了解这些算法在 `TPM` 规范中是如何使用的。

安全专家们可以跳过这一章。如果你以前学过一点安全知识，或者已经生疏，建议你进行略读，以唤醒你的记忆，也能了解基本的加密算法在 `TPMs` 是怎么用的。如果你压根不知道 `TPM` 是啥，那本章是必读的。

`TPM 2.0` 中包含的所有加密算法都基于已被广泛审查的公共标准。创建自定义的强加密算法一般来说是非常困难的。在一个算法被社区公认为强大之前，必须经过多年的密码分析，只有那些符合标准的算法，才能被可信计算组织（`TCG`）批准使用到 `TPM` 中。在本章中，描述了三种算法：用于完整性的哈希算法、用于机密性的对称加密算法以及用于数字签名和密钥管理的非对称加密算法。特别地，我们会探索安全哈希算法：高级加密标准(`AES`)，两个非对称的标准：`RSA` 和椭圆曲线密码(`ECC`)。但是在讨论实际算法之前，需要知道它们被用来防御什么。

本章首先描述了两种攻击类型:暴力攻击和密码分析。然后定义了一些基本概念:消息、保密、完整性、身份验证和授权，以及两个更高层次的概念：反重放和不可抵赖性。最后列出了 `TPM` 中使用的加密算法类。

这些大部分都是通用的安全准则，在 `TPM` 设计中贯穿使用。它们在 `TPM 2.0` 的具体应用，在本书前后都会提到。在少数情况下，`TPM` 使用了非通用的加密方法，规范中有些地方介绍了新的加密术语，我们都会进行说明。（扩展操作就是这两种情况的一个例子：它是一个通用的安全概念，已经以一种新的方式应用在 `TPM` 中。）

`TPM` 中所做的一切在某种程度上都与减轻密码攻击有关。

## 密码攻击
加密是为了防止攻击者做恶意的事情。使用加密的安全系统被设计用于阻止坏人获取你的数据、仿造你、进行不被察觉的文档修改。这些攻击者试图破坏加密设计的安全性，有两种基本的方式：一是通过深入理解数学算法和协议，使用这些知识来寻找和利用设计中的漏洞，二是使用暴力破解。

如果你用的是良好审查过的算法与协议，而且是按着他们设计的方式使用的，那么，你的设计就不会受第一类攻击的影响。因此，你要多注意，应该使用已被接纳的算法与协议。而在暴力破解中，攻击者会尝试各种可能的密钥、输入及密码，来猜测为了保护设计而使用的加密。

### 暴力破解
密码学家不喜欢说一切都是不可能的，相反，他们会说“计算上不可行”，就是说，要尝试每种组合来攻击密码学所花费的时间，是不切实际的。在数据加密标准（`DES`）中，`2^56` 种密钥会被用到，这个数字很大，是 `72,057,594,037,927,936`。破解 `DES` 算法看起来是计算上不可行，然而，在 `1988` 年，有人发明了一台机器，做到了。[^1]
密码经常遭到暴力破解，先是字典中的单词，然后是单词加数字，甚至还有特殊字符。攻击者甚至会使用克林贡单词，以及哈利波特或指环王中的单词！[`RainbowCrack`](www.project-rainbowcrack.com/) 是一个非常有名的程序，可以暴力破解更长的密码。

如果算法的强度不依赖于算法的保密程度，那么这个加密算法就是很好的。如果真是这样，那么它就很难被破解，如果很难被破解，通常就被叫做密钥。防御暴力破解，就是要让密钥足够长，使得很难遍历，或者减少在一段时间内被攻击的次数。

`TCG` 假设它批准的所有算法都是良好设计的. 这并不一定正确，因为该规范不遵循特定算法, 如果有一个算法在未来被发现了弱点，规范并不会被重写，只会把这个算法从已批准的算法列表中移除。

经过良好设计的算法的强度，是通过它对数学攻击的免疫强度来测量的。强度的实现，依赖于算法的类型以及密钥的长度 。

[^1]http://en.wikipedia.org/wiki/Data_Encryption_Standard#Chronology.


#### 通过类型计算算法强度
对称算法用于传统加密，其中用于加密和解密的密钥是相同的。对于设计良好的对称算法，加密算法的强度以指数级依赖于密钥的长度。由此，如果一个密钥只有 `4` 位的长度，那么它就有 `24` 或 `16` 种可能。使用暴力破解的攻击者，把这 `16` 种可能全部尝试一遍，就可以破解密码。其实，平均下来，攻击者只需尝试一半，也就是 `8` 次，就可以找到正确的密钥了。由于指数级的数字很大，算法的强度通常以比特表示。设计良好的对称算法的强度等于其密钥中的位数。在 `TPM` 中，对称算法通常使用 `128、192` 或 `256` 位的密钥。
安全哈希算法像是一种只加密但不解密的算法。这听上去好像没什么用，但其实有很多有意思的用处。安全哈希算法总是生成相同大小的输出，而不依赖于输入。给定一个输入，你总是会得到相同的输出。但是，给定一个输出，你是无法计算输入的。这种算法的强度可以用两种方式来计算：
- 给定一个哈希输出，找到它对应的输入所需要尝试的次数。对于设计良好的哈希算法，这被假定为该输出的位长度。
- `50%` 概率找到同一个输出的两个输入，所需要尝试的次数。对于设计良好的哈希算法，它就是该输出的位长度的一半。[^2]

根据安全哈希的用法，上面两种都是正确的。但是，由于密码学者都是P3人（付费专业达人），第二种更普遍地用于设计良好的安全哈希算法的强度。

非对称算法在首次介绍时会显得很奇怪：加密算法跟解密算法是不一样的，两者使用不同的密钥，包括不同的公钥密钥对。你需要关注两种非对称算法，本章会在后面讲到：RSA（以发明者的名字首字母组成：Rivest、Shamir、Adleman）和椭圆曲线密码（ECC）。

对于非对称算法来说，依据一个专有的密钥长度，是很难计算强度的。比如RSA，你可以查阅一些表格。这些表格中提到RSA非对称密钥的2048位对应于对称密钥中的112位的强度，而3076位则对应于128位，15360位对应于256位。而对于ECC，它的强度则被认为是其密钥长度的一半。因此，256位的ECC密钥，其强度跟128位的对称密钥是一样的，而一个384位的ECC密钥，则对应于192位的对称密钥。

如果密钥长度很长，暴力破解不可行，攻击者就会尝试分析加密算法或协议的数学方法，以期望找到一条捷径。

[^2]这种攻击通常被称为生日攻击，源于一种古老的派对把戏。如果一个房间里有23人（接近365的平方根），其中2人有机会同一个生日的概率是50%。如果房间里有更多的人，概率会上升。如果有40个人，概率几乎是90%。

### 攻击算法本身
密码算法设计是一门艺术。数学基于要解决特定类型问题的难度，而这种难度又是基于当前已有的知识。很难设计一种永远无法发起攻击的算法。

SHA-1哈希算法遭到攻击，成为了TPM 1.2向TPM 2.0发展的契机。在常规环境下，暴力破解生日攻击SHA-1需要2^80次计算，密码强度是80。而这次攻击基于数学中潜在的一个漏洞，成功地将破解所需的计算次数降低到2^63次——密码强度为63。TMP 1.2正好在设计中使用了SHA-1。

## 安全定义